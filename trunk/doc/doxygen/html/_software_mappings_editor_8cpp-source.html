<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Kactus2: D:/user/kamppia/SVNwork/Kactus2 SourceForge/IPXactWrapper/ComponentEditor/software/SoftwareMappingsEditor.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>D:/user/kamppia/SVNwork/Kactus2 SourceForge/IPXactWrapper/ComponentEditor/software/SoftwareMappingsEditor.cpp</h1><a href="_software_mappings_editor_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00002"></a>00002 <span class="comment">// File: SoftwareMappingsEditor.cpp</span>
<a name="l00003"></a>00003 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00004"></a>00004 <span class="comment">// Project: Kactus 2</span>
<a name="l00005"></a>00005 <span class="comment">// Author: Joni-Matti M‰‰tt‰</span>
<a name="l00006"></a>00006 <span class="comment">// Date: 31.10.2011</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// Description:</span>
<a name="l00009"></a>00009 <span class="comment">// Editor for editing software mappings for a specific HW component.</span>
<a name="l00010"></a>00010 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include "<a class="code" href="_software_mappings_editor_8h.html">SoftwareMappingsEditor.h</a>"</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;<a class="code" href="design_8h.html">models/design.h</a>&gt;</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;<a class="code" href="libraryinterface_8h.html">LibraryManager/libraryinterface.h</a>&gt;</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;QVBoxLayout&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;QGridLayout&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;QFileInfo&gt;</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00023"></a>00023 <span class="comment">// Function: SoftwareMappingsEditor()</span>
<a name="l00024"></a>00024 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00025"></a><a class="code" href="class_software_mappings_editor.html#28dd973074ea85cdafcdbd59e2131787">00025</a> <a class="code" href="class_software_mappings_editor.html#28dd973074ea85cdafcdbd59e2131787">SoftwareMappingsEditor::SoftwareMappingsEditor</a>(<a class="code" href="class_library_interface.html" title="LibraryInterface defines an interface to operate the IP-Xact-library.">LibraryInterface</a>* libHandler,
<a name="l00026"></a>00026                                                QSharedPointer&lt;Component&gt; component,
<a name="l00027"></a>00027                                                <span class="keywordtype">void</span>* dataPointer, QWidget *parent,
<a name="l00028"></a>00028                                                QWidget* parentWnd)
<a name="l00029"></a>00029     : <a class="code" href="class_item_editor.html" title="ItemEditor is a base class for editors in Component Editor module.">ItemEditor</a>(component, parent), libInterface_(libHandler), component_(component),
<a name="l00030"></a>00030       swDesignMapping_(<a class="code" href="class_v_l_n_v.html" title="The class to hold VLNV information of a single IP-XACT document.">VLNV</a>::COMPONENT, libHandler, parentWnd, this)
<a name="l00031"></a>00031 {
<a name="l00032"></a>00032 
<a name="l00033"></a>00033     <a class="code" href="class_software_mappings_editor.html#1b9d61b77d7dc9910a86c580b7d3cd91" title="VLNV editor for the mapped SW design.">swDesignMapping_</a>.setTitle(tr(<span class="stringliteral">"Mapped SW Design"</span>));
<a name="l00034"></a>00034     
<a name="l00035"></a>00035     QVBoxLayout* layout = <span class="keyword">new</span> QVBoxLayout(<span class="keyword">this</span>);
<a name="l00036"></a>00036     layout-&gt;addWidget(&amp;<a class="code" href="class_software_mappings_editor.html#1b9d61b77d7dc9910a86c580b7d3cd91" title="VLNV editor for the mapped SW design.">swDesignMapping_</a>);
<a name="l00037"></a>00037     layout-&gt;addStretch(1);
<a name="l00038"></a>00038     
<a name="l00039"></a>00039     <span class="comment">// Connect signals.</span>
<a name="l00040"></a>00040     connect(&amp;<a class="code" href="class_software_mappings_editor.html#1b9d61b77d7dc9910a86c580b7d3cd91" title="VLNV editor for the mapped SW design.">swDesignMapping_</a>, SIGNAL(<a class="code" href="class_item_editor.html#d08ef0cfa6c2ebea2fc650383d27a41e" title="Emitted when the contents of the widget change.">contentChanged</a>()), <span class="keyword">this</span>, SIGNAL(<a class="code" href="class_item_editor.html#d08ef0cfa6c2ebea2fc650383d27a41e" title="Emitted when the contents of the widget change.">contentChanged</a>()));
<a name="l00041"></a>00041 
<a name="l00042"></a>00042     <span class="comment">// Read the existing SW design if found.</span>
<a name="l00043"></a>00043     <a class="code" href="class_v_l_n_v.html" title="The class to hold VLNV information of a single IP-XACT document.">VLNV</a> designVLNV = *<a class="code" href="class_software_mappings_editor.html#c1f449e7aec614e06c946d624399c54b" title="The edited component.">component_</a>-&gt;getVlnv();
<a name="l00044"></a>00044     designVLNV.<a class="code" href="class_v_l_n_v.html#41e8feb8b594eaaf4efc45dc0b520656" title="Set the document type for the vlnv.">setType</a>(<a class="code" href="class_v_l_n_v.html#a8637042ee4c986cba92d87b0917cdabd0d8c760abb417284f7d2da7b69b06a6">VLNV::DESIGN</a>);
<a name="l00045"></a>00045     designVLNV.<a class="code" href="class_v_l_n_v.html#71492c150d4bc3d06d7313c0b6634a9a" title="Set the name for the VLNV.">setName</a>(designVLNV.<a class="code" href="class_v_l_n_v.html#3ff2bdff884da48aa0e936fa5595b7e8" title="Get the name of the IP block in VLNV.">getName</a>().remove(<span class="stringliteral">".comp"</span>) + <span class="stringliteral">"_swmap.design"</span>);
<a name="l00046"></a>00046 
<a name="l00047"></a>00047     <span class="keywordflow">if</span> (<a class="code" href="class_software_mappings_editor.html#1382e8c3a96ea7b61d3c62d5c56da817" title="The library handler.">libInterface_</a>-&gt;<a class="code" href="class_library_interface.html#f6944f708f9aa01568d707fdc773ea91" title="Checks if the library already contains the specified vlnv.">contains</a>(designVLNV))
<a name="l00048"></a>00048     {
<a name="l00049"></a>00049         QSharedPointer&lt;LibraryComponent&gt; libComp = <a class="code" href="class_software_mappings_editor.html#1382e8c3a96ea7b61d3c62d5c56da817" title="The library handler.">libInterface_</a>-&gt;<a class="code" href="class_library_interface.html#92798f5c6f5e72c8f4da87e872812c4f" title="Get a model that matches given VLNV.">getModel</a>(designVLNV);
<a name="l00050"></a>00050         QSharedPointer&lt;Design&gt; design = libComp.staticCast&lt;<a class="code" href="class_design.html" title="Describes an IP-XACT design.">Design</a>&gt;();
<a name="l00051"></a>00051 
<a name="l00052"></a>00052         <span class="keywordflow">if</span> (design-&gt;getComponentInstances().count() &gt; 0)
<a name="l00053"></a>00053         {
<a name="l00054"></a>00054             <a class="code" href="struct_design_1_1_component_instance.html" title="Describes the spirit:componentInstance element in an IP-XACT document.">Design::ComponentInstance</a> <span class="keyword">const</span>&amp; instance =design-&gt;getComponentInstances().first();
<a name="l00055"></a>00055             <a class="code" href="class_software_mappings_editor.html#1b9d61b77d7dc9910a86c580b7d3cd91" title="VLNV editor for the mapped SW design.">swDesignMapping_</a>.<a class="code" href="class_v_l_n_v_editor.html#edef36ca3252c366ed3d222c69d2c765">setVLNV</a>(instance.<a class="code" href="struct_design_1_1_component_instance.html#79dd727125d9cb57c2ff239bc3f73902" title="MANDATORY spirit:componentRef.">componentRef</a>);
<a name="l00056"></a>00056         }
<a name="l00057"></a>00057     }
<a name="l00058"></a>00058 }
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00061"></a>00061 <span class="comment">// Function: ~SoftwareMappingsEditor()</span>
<a name="l00062"></a>00062 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00063"></a><a class="code" href="class_software_mappings_editor.html#83dd02746c563bbb84b65a44767a9016">00063</a> <a class="code" href="class_software_mappings_editor.html#83dd02746c563bbb84b65a44767a9016">SoftwareMappingsEditor::~SoftwareMappingsEditor</a>()
<a name="l00064"></a>00064 {
<a name="l00065"></a>00065 }
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00068"></a>00068 <span class="comment">// Function: isValid()</span>
<a name="l00069"></a>00069 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00070"></a><a class="code" href="class_software_mappings_editor.html#50fd9fc0722500d0f899c8e9b0d7cee6">00070</a> <span class="keywordtype">bool</span> <a class="code" href="class_software_mappings_editor.html#50fd9fc0722500d0f899c8e9b0d7cee6">SoftwareMappingsEditor::isValid</a>()<span class="keyword"> const</span>
<a name="l00071"></a>00071 <span class="keyword"></span>{
<a name="l00072"></a>00072     <span class="comment">// The mapped platform must be either totally empty or valid.</span>
<a name="l00073"></a>00073     <span class="keywordflow">if</span> (!<a class="code" href="class_software_mappings_editor.html#1b9d61b77d7dc9910a86c580b7d3cd91" title="VLNV editor for the mapped SW design.">swDesignMapping_</a>.<a class="code" href="class_v_l_n_v_editor.html#bc51c18e71e347d9a077e0608021ae21">isEmpty</a>() &amp;&amp; !<a class="code" href="class_software_mappings_editor.html#1b9d61b77d7dc9910a86c580b7d3cd91" title="VLNV editor for the mapped SW design.">swDesignMapping_</a>.<a class="code" href="class_v_l_n_v_editor.html#eff4ed9c7b77a464c51bae1dbc48ad6c">isValid</a>())
<a name="l00074"></a>00074     {
<a name="l00075"></a>00075         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00076"></a>00076     }
<a name="l00077"></a>00077 
<a name="l00078"></a>00078     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00079"></a>00079 }
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00082"></a>00082 <span class="comment">// Function: makeChanges()</span>
<a name="l00083"></a>00083 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00084"></a><a class="code" href="class_software_mappings_editor.html#0f768cb853524d6e0255b1d080b51c07">00084</a> <span class="keywordtype">void</span> <a class="code" href="class_software_mappings_editor.html#0f768cb853524d6e0255b1d080b51c07">SoftwareMappingsEditor::makeChanges</a>()
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086     <a class="code" href="class_v_l_n_v.html" title="The class to hold VLNV information of a single IP-XACT document.">VLNV</a> designVLNV = *<a class="code" href="class_software_mappings_editor.html#c1f449e7aec614e06c946d624399c54b" title="The edited component.">component_</a>-&gt;getVlnv();
<a name="l00087"></a>00087     designVLNV.<a class="code" href="class_v_l_n_v.html#41e8feb8b594eaaf4efc45dc0b520656" title="Set the document type for the vlnv.">setType</a>(<a class="code" href="class_v_l_n_v.html#a8637042ee4c986cba92d87b0917cdabd0d8c760abb417284f7d2da7b69b06a6">VLNV::DESIGN</a>);
<a name="l00088"></a>00088     designVLNV.<a class="code" href="class_v_l_n_v.html#71492c150d4bc3d06d7313c0b6634a9a" title="Set the name for the VLNV.">setName</a>(designVLNV.<a class="code" href="class_v_l_n_v.html#3ff2bdff884da48aa0e936fa5595b7e8" title="Get the name of the IP block in VLNV.">getName</a>().remove(<span class="stringliteral">".comp"</span>) + <span class="stringliteral">"_swmap.design"</span>);
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <span class="comment">// Create the SW design if there is something to save.</span>
<a name="l00091"></a>00091     <span class="keywordflow">if</span> (<a class="code" href="class_software_mappings_editor.html#1b9d61b77d7dc9910a86c580b7d3cd91" title="VLNV editor for the mapped SW design.">swDesignMapping_</a>.<a class="code" href="class_v_l_n_v_editor.html#eff4ed9c7b77a464c51bae1dbc48ad6c">isValid</a>())
<a name="l00092"></a>00092     {
<a name="l00093"></a>00093         <span class="comment">// Create the view for the component if it does not exist.</span>
<a name="l00094"></a>00094         <span class="keywordflow">if</span> (<a class="code" href="class_software_mappings_editor.html#c1f449e7aec614e06c946d624399c54b" title="The edited component.">component_</a>-&gt;findView(<span class="stringliteral">"kts_sw_ref"</span>) == 0)
<a name="l00095"></a>00095         {
<a name="l00096"></a>00096             <a class="code" href="class_view.html" title="Equals the spirit:view element in IP-Xact specification.">View</a>* view = <span class="keyword">new</span> <a class="code" href="class_view.html" title="Equals the spirit:view element in IP-Xact specification.">View</a>(<span class="stringliteral">"kts_sw_ref"</span>);
<a name="l00097"></a>00097             view-&gt;<a class="code" href="class_view.html#88f049f1259e09c9476553ca670f78d4" title="Add a new envIdentifier for this view.">addEnvIdentifier</a>(<span class="stringliteral">""</span>);
<a name="l00098"></a>00098             view-&gt;<a class="code" href="class_view.html#54742356d37991cc78b89f39c80cae87" title="Set the hierarchyRef for this view.">setHierarchyRef</a>(designVLNV);
<a name="l00099"></a>00099             <a class="code" href="class_software_mappings_editor.html#c1f449e7aec614e06c946d624399c54b" title="The edited component.">component_</a>-&gt;addView(view);
<a name="l00100"></a>00100         }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102         QSharedPointer&lt;Design&gt; design(<span class="keyword">new</span> <a class="code" href="class_design.html" title="Describes an IP-XACT design.">Design</a>(designVLNV));
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         QList&lt;Design::ComponentInstance&gt; instances;
<a name="l00105"></a>00105         <a class="code" href="struct_design_1_1_component_instance.html" title="Describes the spirit:componentInstance element in an IP-XACT document.">Design::ComponentInstance</a> instance(<a class="code" href="class_software_mappings_editor.html#1b9d61b77d7dc9910a86c580b7d3cd91" title="VLNV editor for the mapped SW design.">swDesignMapping_</a>.<a class="code" href="class_v_l_n_v_editor.html#ec64dfb071b106bbe96b95788cd1df25">getVLNV</a>().<a class="code" href="class_v_l_n_v.html#3ff2bdff884da48aa0e936fa5595b7e8" title="Get the name of the IP block in VLNV.">getName</a>().remove(<span class="stringliteral">".comp"</span>),
<a name="l00106"></a>00106                                            QString(), QString(), <a class="code" href="class_software_mappings_editor.html#1b9d61b77d7dc9910a86c580b7d3cd91" title="VLNV editor for the mapped SW design.">swDesignMapping_</a>.<a class="code" href="class_v_l_n_v_editor.html#ec64dfb071b106bbe96b95788cd1df25">getVLNV</a>(), QPointF());
<a name="l00107"></a>00107         instances.append(instance);
<a name="l00108"></a>00108 
<a name="l00109"></a>00109         design-&gt;setComponentInstances(instances);
<a name="l00110"></a>00110 
<a name="l00111"></a>00111         <span class="keywordflow">if</span> (<a class="code" href="class_software_mappings_editor.html#1382e8c3a96ea7b61d3c62d5c56da817" title="The library handler.">libInterface_</a>-&gt;<a class="code" href="class_library_interface.html#f6944f708f9aa01568d707fdc773ea91" title="Checks if the library already contains the specified vlnv.">contains</a>(designVLNV))
<a name="l00112"></a>00112         {
<a name="l00113"></a>00113             <a class="code" href="class_software_mappings_editor.html#1382e8c3a96ea7b61d3c62d5c56da817" title="The library handler.">libInterface_</a>-&gt;<a class="code" href="class_library_interface.html#a841b91f4281dc02f2d3bf871f8bab45" title="Write the model to file system to given file path.">writeModelToFile</a>(design);
<a name="l00114"></a>00114         }
<a name="l00115"></a>00115         <span class="keywordflow">else</span>
<a name="l00116"></a>00116         {
<a name="l00117"></a>00117             QFileInfo fileInfo(<a class="code" href="class_software_mappings_editor.html#1382e8c3a96ea7b61d3c62d5c56da817" title="The library handler.">libInterface_</a>-&gt;<a class="code" href="class_library_interface.html#d76e2648d944acbd458ae4727342bcf4" title="Get a path to the specified IP-Xact document.">getPath</a>(*<a class="code" href="class_software_mappings_editor.html#c1f449e7aec614e06c946d624399c54b" title="The edited component.">component_</a>-&gt;getVlnv()));
<a name="l00118"></a>00118             <a class="code" href="class_software_mappings_editor.html#1382e8c3a96ea7b61d3c62d5c56da817" title="The library handler.">libInterface_</a>-&gt;<a class="code" href="class_library_interface.html#a841b91f4281dc02f2d3bf871f8bab45" title="Write the model to file system to given file path.">writeModelToFile</a>(fileInfo.path(), design);
<a name="l00119"></a>00119         }
<a name="l00120"></a>00120     }
<a name="l00121"></a>00121     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_software_mappings_editor.html#1382e8c3a96ea7b61d3c62d5c56da817" title="The library handler.">libInterface_</a>-&gt;<a class="code" href="class_library_interface.html#f6944f708f9aa01568d707fdc773ea91" title="Checks if the library already contains the specified vlnv.">contains</a>(designVLNV))
<a name="l00122"></a>00122     {
<a name="l00123"></a>00123         <a class="code" href="class_software_mappings_editor.html#1382e8c3a96ea7b61d3c62d5c56da817" title="The library handler.">libInterface_</a>-&gt;<a class="code" href="class_library_interface.html#04bddcde316682e17018dba4427af583" title="Remove the specified library object from the library and file system.">removeObject</a>(designVLNV);
<a name="l00124"></a>00124     }
<a name="l00125"></a>00125 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Nov 30 12:12:41 2011 for Kactus2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
