<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Kactus2: D:/user/kamppia/SVNwork/Kactus2 SourceForge/designwidget/diagraminterface.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>D:/user/kamppia/SVNwork/Kactus2 SourceForge/designwidget/diagraminterface.cpp</h1><a href="diagraminterface_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00002"></a>00002 <span class="comment">// File: diagraminterface.cpp</span>
<a name="l00003"></a>00003 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00004"></a>00004 <span class="comment">// Project: Kactus 2</span>
<a name="l00005"></a>00005 <span class="comment">// Author: Joni-Matti M‰‰tt‰</span>
<a name="l00006"></a>00006 <span class="comment">// Date: 17.3.2011</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// Description:</span>
<a name="l00009"></a>00009 <span class="comment">// Diagram interface graphics item.</span>
<a name="l00010"></a>00010 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include "<a class="code" href="diagraminterface_8h.html">diagraminterface.h</a>"</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="diagramcomponent_8h.html">diagramcomponent.h</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include "<a class="code" href="diagraminterconnection_8h.html">diagraminterconnection.h</a>"</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "<a class="code" href="_portmap_dialog_8h.html">PortmapDialog.h</a>"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include "<a class="code" href="_bus_interface_dialog_8h.html">BusInterfaceDialog.h</a>"</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include "<a class="code" href="_diagram_move_commands_8h.html">DiagramMoveCommands.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include "<a class="code" href="blockdiagram_8h.html">blockdiagram.h</a>"</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#include "<a class="code" href="_diagram_column_8h.html">columnview/DiagramColumn.h</a>"</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include "<a class="code" href="_diagram_column_layout_8h.html">columnview/DiagramColumnLayout.h</a>"</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="businterface_8h.html">models/businterface.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="component_8h.html">models/component.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="port_8h.html">models/port.h</a>&gt;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="_generic_edit_provider_8h.html">common/GenericEditProvider.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="diagramgrid_8h.html">common/diagramgrid.h</a>&gt;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;QBrush&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;QPen&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;QPainter&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;QStyleOptionGraphicsItem&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;QColor&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;QFont&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;QGraphicsDropShadowEffect&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;QDebug&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;QMessageBox&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;QCoreApplication&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;QGraphicsScene&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;QPushButton&gt;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00045"></a>00045 <span class="comment">// Function: DiagramInterface()</span>
<a name="l00046"></a>00046 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00047"></a><a class="code" href="class_diagram_interface.html#67b5da98323c757f105e5ed2e7d22cf3">00047</a> <a class="code" href="class_diagram_interface.html#67b5da98323c757f105e5ed2e7d22cf3">DiagramInterface::DiagramInterface</a>(<a class="code" href="class_library_interface.html" title="LibraryInterface defines an interface to operate the IP-Xact-library.">LibraryInterface</a>* lh, QSharedPointer&lt;Component&gt; component,
<a name="l00048"></a>00048                                    QSharedPointer&lt;BusInterface&gt; busIf,
<a name="l00049"></a>00049                                    QGraphicsItem *parent)
<a name="l00050"></a>00050     : <a class="code" href="class_diagram_connection_end_point.html" title="DiagramConnectionEndPoint interface.">DiagramConnectionEndPoint</a>(parent, QVector2D(1.0f, 0.0f)),
<a name="l00051"></a>00051       lh_(lh), nameLabel_(0), busInterface_(), component_(component), oldColumn_(0),
<a name="l00052"></a>00052       temp_(busIf == 0), oldPos_(), oldInterfacePositions_()
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054     <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a> = busIf;
<a name="l00055"></a>00055     <span class="keywordtype">int</span> squareSize = <a class="code" href="diagramgrid_8h.html#550f81d71b4b514a24f5a8e3023a1152">GridSize</a>;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057     <span class="comment">// The shape is of form:</span>
<a name="l00058"></a>00058     <span class="comment">// /\</span>
<a name="l00059"></a>00059     <span class="comment">// ||</span>
<a name="l00060"></a>00060     <span class="comment">// ||</span>
<a name="l00061"></a>00061     QPolygonF shape;
<a name="l00062"></a>00062     shape &lt;&lt; QPointF(-squareSize/2, squareSize * 2)
<a name="l00063"></a>00063           &lt;&lt; QPointF(-squareSize/2, 0)
<a name="l00064"></a>00064           &lt;&lt; QPointF(0, -squareSize/2)
<a name="l00065"></a>00065           &lt;&lt; QPointF(squareSize/2, 0)
<a name="l00066"></a>00066           &lt;&lt; QPointF(squareSize/2, squareSize * 2);
<a name="l00067"></a>00067     setPolygon(shape);
<a name="l00068"></a>00068     
<a name="l00069"></a>00069     <a class="code" href="class_diagram_interface.html#b2d6ac125253fb58e9b905d2b6f07d78" title="The name label.">nameLabel_</a> = <span class="keyword">new</span> QGraphicsTextItem(<span class="stringliteral">""</span>, <span class="keyword">this</span>);
<a name="l00070"></a>00070     QFont font = <a class="code" href="class_diagram_interface.html#b2d6ac125253fb58e9b905d2b6f07d78" title="The name label.">nameLabel_</a>-&gt;font();
<a name="l00071"></a>00071     font.setPointSize(8);
<a name="l00072"></a>00072     <a class="code" href="class_diagram_interface.html#b2d6ac125253fb58e9b905d2b6f07d78" title="The name label.">nameLabel_</a>-&gt;setFont(font);
<a name="l00073"></a>00073     <a class="code" href="class_diagram_interface.html#b2d6ac125253fb58e9b905d2b6f07d78" title="The name label.">nameLabel_</a>-&gt;setFlag(ItemIgnoresTransformations);
<a name="l00074"></a>00074     <a class="code" href="class_diagram_interface.html#b2d6ac125253fb58e9b905d2b6f07d78" title="The name label.">nameLabel_</a>-&gt;setFlag(ItemStacksBehindParent);
<a name="l00075"></a>00075     QGraphicsDropShadowEffect *shadow = <span class="keyword">new</span> QGraphicsDropShadowEffect;
<a name="l00076"></a>00076     shadow-&gt;setXOffset(0);
<a name="l00077"></a>00077     shadow-&gt;setYOffset(0);
<a name="l00078"></a>00078     shadow-&gt;setBlurRadius(5);
<a name="l00079"></a>00079     <a class="code" href="class_diagram_interface.html#b2d6ac125253fb58e9b905d2b6f07d78" title="The name label.">nameLabel_</a>-&gt;setGraphicsEffect(shadow);
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     setFlag(ItemIsMovable);
<a name="l00082"></a>00082     setFlag(ItemIsSelectable);
<a name="l00083"></a>00083     setFlag(ItemSendsGeometryChanges);
<a name="l00084"></a>00084     setFlag(ItemSendsScenePositionChanges);
<a name="l00085"></a>00085 
<a name="l00086"></a>00086     <a class="code" href="class_diagram_interface.html#cf3ba89c9ed6c8da64d399aefb9bdd56" title="Update the graphics to match the IP-XACT bus interface.">updateInterface</a>();
<a name="l00087"></a>00087 }
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="class_diagram_interface.html#2a926c31758aca5f1722fab5e6eeb5eb">00089</a> <a class="code" href="class_diagram_interface.html#2a926c31758aca5f1722fab5e6eeb5eb" title="The destructor.">DiagramInterface::~DiagramInterface</a>() {
<a name="l00090"></a>00090     <a class="code" href="class_diagram_column.html" title="DiagramColumn class.">DiagramColumn</a>* column = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_diagram_column.html" title="DiagramColumn class.">DiagramColumn</a>*<span class="keyword">&gt;</span>(parentItem());
<a name="l00091"></a>00091 
<a name="l00092"></a>00092     <span class="keywordflow">if</span> (column != 0)
<a name="l00093"></a>00093     {
<a name="l00094"></a>00094         column-&gt;<a class="code" href="class_diagram_column.html#d06eafc748b7b697464e807761343355">removeItem</a>(<span class="keyword">this</span>);
<a name="l00095"></a>00095     }
<a name="l00096"></a>00096 }
<a name="l00097"></a>00097 
<a name="l00098"></a><a class="code" href="class_diagram_interface.html#abc57a2302a40653d607b1196811ee12">00098</a> QString <a class="code" href="class_diagram_interface.html#abc57a2302a40653d607b1196811ee12" title="Returns the name of this port.">DiagramInterface::name</a>()<span class="keyword"> const</span>
<a name="l00099"></a>00099 <span class="keyword"></span>{
<a name="l00100"></a>00100     <span class="keywordflow">return</span> <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;getName();
<a name="l00101"></a>00101 }
<a name="l00102"></a>00102 
<a name="l00103"></a><a class="code" href="class_diagram_interface.html#aa92557f366a9f549cebe38b7239e506">00103</a> <span class="keywordtype">void</span> <a class="code" href="class_diagram_interface.html#aa92557f366a9f549cebe38b7239e506" title="Set the name for the interface.">DiagramInterface::setName</a>( <span class="keyword">const</span> QString&amp; <a class="code" href="class_diagram_interface.html#abc57a2302a40653d607b1196811ee12" title="Returns the name of this port.">name</a> ) {
<a name="l00104"></a>00104         <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;setName(name);
<a name="l00105"></a>00105         <a class="code" href="class_diagram_interface.html#cf3ba89c9ed6c8da64d399aefb9bdd56" title="Update the graphics to match the IP-XACT bus interface.">updateInterface</a>();
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a><a class="code" href="class_diagram_interface.html#dcd0ec4717f948192730479847027181">00108</a> QSharedPointer&lt;BusInterface&gt; <a class="code" href="class_diagram_interface.html#dcd0ec4717f948192730479847027181">DiagramInterface::getBusInterface</a>()<span class="keyword"> const</span>
<a name="l00109"></a>00109 <span class="keyword"></span>{
<a name="l00110"></a>00110     <span class="keywordflow">return</span> <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>;
<a name="l00111"></a>00111 }
<a name="l00112"></a>00112 
<a name="l00113"></a><a class="code" href="class_diagram_interface.html#cf3ba89c9ed6c8da64d399aefb9bdd56">00113</a> <span class="keywordtype">void</span> <a class="code" href="class_diagram_interface.html#cf3ba89c9ed6c8da64d399aefb9bdd56" title="Update the graphics to match the IP-XACT bus interface.">DiagramInterface::updateInterface</a>()
<a name="l00114"></a>00114 {
<a name="l00115"></a>00115         Q_ASSERT(<a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>);
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     <span class="keywordflow">switch</span> (<a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;getInterfaceMode()) {
<a name="l00118"></a>00118     <span class="keywordflow">case</span> <a class="code" href="namespace_general.html#4ad6b85c4743ddccd234a0efcf7d05af2cc899e2778757d2d299416d25b524a3">General::MASTER</a>:
<a name="l00119"></a>00119         setBrush(QBrush(QColor(0x32,0xcb,0xcb)));
<a name="l00120"></a>00120         <span class="keywordflow">break</span>;
<a name="l00121"></a>00121     <span class="keywordflow">case</span> <a class="code" href="namespace_general.html#4ad6b85c4743ddccd234a0efcf7d05af3fdaca994f5e9c6ac9f86ea54db2f974">General::SLAVE</a>:
<a name="l00122"></a>00122         setBrush(QBrush(QColor(0x32,0x99,0x64)));
<a name="l00123"></a>00123         <span class="keywordflow">break</span>;
<a name="l00124"></a>00124     <span class="keywordflow">case</span> <a class="code" href="namespace_general.html#4ad6b85c4743ddccd234a0efcf7d05af1f60b9f796fd07f10b1e3dc33a2960f5">General::MIRROREDMASTER</a>:
<a name="l00125"></a>00125         setBrush(QBrush(QColor(0xcb,0xfd,0xfd)));
<a name="l00126"></a>00126         <span class="keywordflow">break</span>;
<a name="l00127"></a>00127     <span class="keywordflow">case</span> <a class="code" href="namespace_general.html#4ad6b85c4743ddccd234a0efcf7d05af84762faaa1e5f7a31b250351388b4081">General::MIRROREDSLAVE</a>:
<a name="l00128"></a>00128         setBrush(QBrush(QColor(0x00,0xfd,00)));
<a name="l00129"></a>00129         <span class="keywordflow">break</span>;
<a name="l00130"></a>00130     <span class="keywordflow">case</span> <a class="code" href="namespace_general.html#4ad6b85c4743ddccd234a0efcf7d05af4da2da4c45ffe1c04255ac2122647b95">General::SYSTEM</a>:
<a name="l00131"></a>00131         setBrush(QBrush(QColor(0xf9,0x11,0x11)));
<a name="l00132"></a>00132         <span class="keywordflow">break</span>;
<a name="l00133"></a>00133     <span class="keywordflow">case</span> <a class="code" href="namespace_general.html#4ad6b85c4743ddccd234a0efcf7d05afe55b04fb7bb4d0c871938ce160f395b5">General::MIRROREDSYSTEM</a>:
<a name="l00134"></a>00134         setBrush(QBrush(QColor(0xf9,0x9d,0xcb)));
<a name="l00135"></a>00135         <span class="keywordflow">break</span>;
<a name="l00136"></a>00136     <span class="keywordflow">case</span> <a class="code" href="namespace_general.html#4ad6b85c4743ddccd234a0efcf7d05afe645d4ea06b12937fb4ffe3c8e6d2bdd">General::MONITOR</a>:
<a name="l00137"></a>00137         setBrush(QBrush(QColor(0xfd,0xfd,0xfd)));
<a name="l00138"></a>00138         <span class="keywordflow">break</span>;
<a name="l00139"></a>00139         <span class="comment">// if undefined</span>
<a name="l00140"></a>00140         <span class="keywordflow">default</span>:
<a name="l00141"></a>00141                 setBrush(QBrush(Qt::black));
<a name="l00142"></a>00142                 <span class="keywordflow">break</span>;
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     <a class="code" href="class_diagram_interface.html#b2d6ac125253fb58e9b905d2b6f07d78" title="The name label.">nameLabel_</a>-&gt;setHtml(<span class="stringliteral">"&lt;div style=\"background-color:#eeeeee; padding:10px 10px;\"&gt;"</span>
<a name="l00146"></a>00146                         +<a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;getName().left(15)+<span class="stringliteral">"&lt;/div&gt;"</span>);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148     qreal nameWidth = <a class="code" href="class_diagram_interface.html#b2d6ac125253fb58e9b905d2b6f07d78" title="The name label.">nameLabel_</a>-&gt;boundingRect().width();
<a name="l00149"></a>00149     
<a name="l00150"></a>00150     <span class="comment">// Check if the port is directed to the left.</span>
<a name="l00151"></a>00151     <span class="keywordflow">if</span> (<a class="code" href="class_diagram_connection_end_point.html#24e5426821cdf4df2c7884979085d303">getDirection</a>().x() &lt; 0)
<a name="l00152"></a>00152     {
<a name="l00153"></a>00153         <a class="code" href="class_diagram_interface.html#b2d6ac125253fb58e9b905d2b6f07d78" title="The name label.">nameLabel_</a>-&gt;setPos(0, <a class="code" href="diagramgrid_8h.html#550f81d71b4b514a24f5a8e3023a1152">GridSize</a> * 3.0 / 4.0 - nameWidth / 2.0);
<a name="l00154"></a>00154     }
<a name="l00155"></a>00155     <span class="comment">// Otherwise the port is directed to the right.</span>
<a name="l00156"></a>00156     <span class="keywordflow">else</span>
<a name="l00157"></a>00157     {
<a name="l00158"></a>00158         <a class="code" href="class_diagram_interface.html#b2d6ac125253fb58e9b905d2b6f07d78" title="The name label.">nameLabel_</a>-&gt;setPos(0, <a class="code" href="diagramgrid_8h.html#550f81d71b4b514a24f5a8e3023a1152">GridSize</a> * 3.0 / 4.0 + nameWidth / 2.0);
<a name="l00159"></a>00159     }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161     emit <a class="code" href="class_diagram_connection_end_point.html#fa7779ad1a6499aa86670c8a0878a5fd" title="Signals that the contents of the interface have been changed.">contentChanged</a>();
<a name="l00162"></a>00162 }
<a name="l00163"></a>00163 
<a name="l00164"></a><a class="code" href="class_diagram_interface.html#1aa90061c231fc1332b849a26486dc58">00164</a> <span class="keywordtype">bool</span> <a class="code" href="class_diagram_interface.html#1aa90061c231fc1332b849a26486dc58" title="Returns true if the port represents a hierarchical connection.">DiagramInterface::isHierarchical</a>()<span class="keyword"> const</span>
<a name="l00165"></a>00165 <span class="keyword"></span>{
<a name="l00166"></a>00166     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00167"></a>00167 }
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00170"></a>00170 <span class="comment">// Function: onConnect()</span>
<a name="l00171"></a>00171 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00172"></a><a class="code" href="class_diagram_interface.html#9b7c8fd430551c93e9479f061630ce73">00172</a> <span class="keywordtype">bool</span> <a class="code" href="class_diagram_interface.html#9b7c8fd430551c93e9479f061630ce73">DiagramInterface::onConnect</a>(<a class="code" href="class_diagram_connection_end_point.html" title="DiagramConnectionEndPoint interface.">DiagramConnectionEndPoint</a> <span class="keyword">const</span>* other)
<a name="l00173"></a>00173 {
<a name="l00174"></a>00174     <span class="comment">// Update the name if the bus interface is defined but its name is empty.</span>
<a name="l00175"></a>00175     <span class="keywordflow">if</span> (<a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;getInterfaceMode() != <a class="code" href="namespace_general.html#4ad6b85c4743ddccd234a0efcf7d05af61ac6c29fbb1f013aba47f69b1e096a9">General::MODE_UNDEFINED</a> &amp;&amp; <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;getName() == <span class="stringliteral">""</span>)
<a name="l00176"></a>00176     {
<a name="l00177"></a>00177         <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;setName(other-&gt;<a class="code" href="class_diagram_connection_end_point.html#72cac94a1d12b11e347aa6295b1a6837">getBusInterface</a>()-&gt;getName());
<a name="l00178"></a>00178         <a class="code" href="class_diagram_interface.html#cf3ba89c9ed6c8da64d399aefb9bdd56" title="Update the graphics to match the IP-XACT bus interface.">updateInterface</a>();
<a name="l00179"></a>00179     }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     <span class="comment">// If the bus interface is already defined or the other endpoint</span>
<a name="l00182"></a>00182     <span class="comment">// does not have a valid bus interface (unpackaged), we don't have to do anything.</span>
<a name="l00183"></a>00183     <span class="keywordflow">if</span> (<a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;getInterfaceMode() != <a class="code" href="namespace_general.html#4ad6b85c4743ddccd234a0efcf7d05af61ac6c29fbb1f013aba47f69b1e096a9">General::MODE_UNDEFINED</a> ||
<a name="l00184"></a>00184         !other-&gt;<a class="code" href="class_diagram_connection_end_point.html#72cac94a1d12b11e347aa6295b1a6837">getBusInterface</a>()-&gt;getBusType().isValid())
<a name="l00185"></a>00185     {
<a name="l00186"></a>00186         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00187"></a>00187     }
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <span class="comment">// Determine the name for the interface.</span>
<a name="l00190"></a>00190     QString newBusIfName = other-&gt;<a class="code" href="class_diagram_connection_end_point.html#72cac94a1d12b11e347aa6295b1a6837">getBusInterface</a>()-&gt;getName();
<a name="l00191"></a>00191     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = 0;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <span class="keywordflow">while</span> (<a class="code" href="class_diagram_interface.html#bf23f45de2420db673deaf1530f43d28" title="The top-level component.">component_</a>-&gt;getBusInterface(newBusIfName) != 0)
<a name="l00194"></a>00194     {
<a name="l00195"></a>00195         ++index;
<a name="l00196"></a>00196         newBusIfName = other-&gt;<a class="code" href="class_diagram_connection_end_point.html#72cac94a1d12b11e347aa6295b1a6837">getBusInterface</a>()-&gt;getName() + <span class="stringliteral">"_"</span> + QString::number(index);
<a name="l00197"></a>00197     }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     <span class="comment">// Create a new bus interface for the diagram interface.</span>
<a name="l00200"></a>00200     QSharedPointer&lt;BusInterface&gt; newBusIf(<span class="keyword">new</span> <a class="code" href="class_bus_interface.html" title="Equals the spirit:busInterface element in IP-Xact specification.">BusInterface</a>());
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     newBusIf-&gt;setName(newBusIfName);
<a name="l00203"></a>00203     newBusIf-&gt;setName(newBusIfName);
<a name="l00204"></a>00204     newBusIf-&gt;setInterfaceMode(other-&gt;<a class="code" href="class_diagram_connection_end_point.html#72cac94a1d12b11e347aa6295b1a6837">getBusInterface</a>()-&gt;getInterfaceMode());
<a name="l00205"></a>00205     newBusIf-&gt;setBusType(other-&gt;<a class="code" href="class_diagram_connection_end_point.html#72cac94a1d12b11e347aa6295b1a6837">getBusInterface</a>()-&gt;getBusType());
<a name="l00206"></a>00206     newBusIf-&gt;setAbstractionType(other-&gt;<a class="code" href="class_diagram_connection_end_point.html#72cac94a1d12b11e347aa6295b1a6837">getBusInterface</a>()-&gt;getAbstractionType());
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     <span class="keywordflow">if</span> (!static_cast&lt;BlockDiagram*&gt;(scene())-&gt;getEditProvider().isPerformingUndoRedo())
<a name="l00209"></a>00209     {
<a name="l00210"></a>00210         <span class="comment">// Ask the user if he wants to auto-copy the port maps from the other end point.</span>
<a name="l00211"></a>00211         QMessageBox msgBox(QMessageBox::Question, QCoreApplication::applicationName(),
<a name="l00212"></a>00212                            tr(<span class="stringliteral">"Do you want to auto-copy the port maps from the port or "</span>
<a name="l00213"></a>00213                               <span class="stringliteral">"perform manual setup instead?"</span>), QMessageBox::NoButton,
<a name="l00214"></a>00214                            (QWidget*)scene()-&gt;parent());
<a name="l00215"></a>00215         QPushButton* btnCopy = msgBox.addButton(tr(<span class="stringliteral">"Copy"</span>), QMessageBox::YesRole);
<a name="l00216"></a>00216         QPushButton* btnManual = msgBox.addButton(tr(<span class="stringliteral">"Manual Setup"</span>), QMessageBox::NoRole);
<a name="l00217"></a>00217 
<a name="l00218"></a>00218         msgBox.exec();
<a name="l00219"></a>00219 
<a name="l00220"></a>00220         <span class="keywordflow">if</span> (msgBox.clickedButton() == btnCopy)
<a name="l00221"></a>00221         {
<a name="l00222"></a>00222             <span class="comment">// The user pressed copy, so duplicate all physical ports from the other end point </span>
<a name="l00223"></a>00223             <span class="comment">// and create the new port maps at the same time.</span>
<a name="l00224"></a>00224             Q_ASSERT(other-&gt;<a class="code" href="class_diagram_connection_end_point.html#e56a455b02d91aa706f78208d0b00c54">encompassingComp</a>() != 0);
<a name="l00225"></a>00225             QSharedPointer&lt;Component&gt; otherComp = other-&gt;<a class="code" href="class_diagram_connection_end_point.html#e56a455b02d91aa706f78208d0b00c54">encompassingComp</a>()-&gt;<a class="code" href="class_component_item.html#49a73ee33e425a3ff37d93e68ca33c99">componentModel</a>();
<a name="l00226"></a>00226 
<a name="l00227"></a>00227             QList&lt; QSharedPointer&lt;Port&gt; &gt; newPorts;
<a name="l00228"></a>00228             QList&lt; QSharedPointer&lt;General::PortMap&gt; &gt; newPortMaps;
<a name="l00229"></a>00229 
<a name="l00230"></a>00230             QList&lt; QSharedPointer&lt;General::PortMap&gt; &gt; <span class="keyword">const</span>&amp; portMaps = other-&gt;<a class="code" href="class_diagram_connection_end_point.html#72cac94a1d12b11e347aa6295b1a6837">getBusInterface</a>()-&gt;getPortMaps();
<a name="l00231"></a>00231 
<a name="l00232"></a>00232             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; portMaps.size(); ++i)
<a name="l00233"></a>00233             {
<a name="l00234"></a>00234                 <span class="comment">// Retrieve the port from the model.</span>
<a name="l00235"></a>00235                 <a class="code" href="class_port.html" title="Equals the spirit:port element in IP-Xact specification.">Port</a>* port = otherComp-&gt;getPort(portMaps.at(i)-&gt;physicalPort_);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237                 <span class="comment">// Check if the port was not found.</span>
<a name="l00238"></a>00238                 <span class="keywordflow">if</span> (port == 0)
<a name="l00239"></a>00239                 {
<a name="l00240"></a>00240                     emit <a class="code" href="class_diagram_interface.html#5ff1cfe6199cdde2f94552127119fd15" title="Send an error message to the user.">errorMessage</a>(tr(<span class="stringliteral">"Port %1 was not found in component %2 while "</span>
<a name="l00241"></a>00241                                          <span class="stringliteral">"copying the bus interface."</span>).arg(portMaps.at(i)-&gt;physicalPort_).arg(
<a name="l00242"></a>00242                                          other-&gt;<a class="code" href="class_diagram_connection_end_point.html#e56a455b02d91aa706f78208d0b00c54">encompassingComp</a>()-&gt;<a class="code" href="class_component_item.html#065f3fb7a863a24ab7e5e1cbef4bf417">name</a>()));
<a name="l00243"></a>00243                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00244"></a>00244                 }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246                 <span class="comment">// The new port inherits the same name as the physical port in the other component.</span>
<a name="l00247"></a>00247                 QString newPortName = portMaps.at(i)-&gt;physicalPort_;
<a name="l00248"></a>00248                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> runningNumber = 0;
<a name="l00249"></a>00249 
<a name="l00250"></a>00250                 <span class="comment">// Make sure that the port name is unique.</span>
<a name="l00251"></a>00251                 <span class="keywordflow">while</span> (<a class="code" href="class_diagram_interface.html#bf23f45de2420db673deaf1530f43d28" title="The top-level component.">component_</a>-&gt;getPort(newPortName) != 0)
<a name="l00252"></a>00252                 {
<a name="l00253"></a>00253                     ++runningNumber;
<a name="l00254"></a>00254                     newPortName = portMaps.at(i)-&gt;physicalPort_ + <span class="stringliteral">"_"</span> + QString::number(runningNumber);
<a name="l00255"></a>00255                 }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257                 <span class="comment">// Make a duplicate of the port with the new name.</span>
<a name="l00258"></a>00258                 QSharedPointer&lt;Port&gt; newPort(<span class="keyword">new</span> <a class="code" href="class_port.html" title="Equals the spirit:port element in IP-Xact specification.">Port</a>(newPortName, *port));
<a name="l00259"></a>00259 
<a name="l00260"></a>00260                 <span class="comment">// And add the port map to the bus interface.</span>
<a name="l00261"></a>00261                 QSharedPointer&lt;General::PortMap&gt; portMap(<span class="keyword">new</span> <a class="code" href="struct_general_1_1_port_map.html" title="Describes the mapping between the logical and physical ports.">General::PortMap</a>);
<a name="l00262"></a>00262                 portMap-&gt;logicalPort_ = portMaps.at(i)-&gt;logicalPort_;
<a name="l00263"></a>00263                 portMap-&gt;physicalPort_ = newPortName;
<a name="l00264"></a>00264 
<a name="l00265"></a>00265                 <span class="comment">// Use the same logical vector but set the physical vector accordingly.</span>
<a name="l00266"></a>00266                 portMap-&gt;logicalVector_ = portMaps.at(i)-&gt;logicalVector_;
<a name="l00267"></a>00267 
<a name="l00268"></a>00268                 <span class="keywordflow">if</span> (portMaps.at(i)-&gt;logicalVector_ != 0)
<a name="l00269"></a>00269                 {
<a name="l00270"></a>00270                     portMap-&gt;physicalVector_ =
<a name="l00271"></a>00271                         QSharedPointer&lt;Vector&gt;(<span class="keyword">new</span> <a class="code" href="class_vector.html" title="Equals the spirit:vector element in IP-Xact specification.">Vector</a>(portMaps.at(i)-&gt;logicalVector_-&gt;getSize() - 1, 0));
<a name="l00272"></a>00272 
<a name="l00273"></a>00273                     newPort-&gt;setLeftBound(portMaps.at(i)-&gt;logicalVector_-&gt;getSize() - 1);
<a name="l00274"></a>00274                     newPort-&gt;setRightBound(0);
<a name="l00275"></a>00275                 }
<a name="l00276"></a>00276                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (portMaps.at(i)-&gt;physicalVector_ != 0)
<a name="l00277"></a>00277                 {
<a name="l00278"></a>00278                     portMap-&gt;physicalVector_ =
<a name="l00279"></a>00279                         QSharedPointer&lt;Vector&gt;(<span class="keyword">new</span> <a class="code" href="class_vector.html" title="Equals the spirit:vector element in IP-Xact specification.">Vector</a>(portMaps.at(i)-&gt;physicalVector_-&gt;getSize() - 1, 0));
<a name="l00280"></a>00280 
<a name="l00281"></a>00281                     newPort-&gt;setLeftBound(portMaps.at(i)-&gt;physicalVector_-&gt;getSize() - 1);
<a name="l00282"></a>00282                     newPort-&gt;setRightBound(0);
<a name="l00283"></a>00283                 }
<a name="l00284"></a>00284 
<a name="l00285"></a>00285                 newPorts.append(newPort);
<a name="l00286"></a>00286                 newPortMaps.append(portMap);
<a name="l00287"></a>00287             }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289             <span class="comment">// Add the duplicated ports to the top-level component.</span>
<a name="l00290"></a>00290             <span class="keywordflow">foreach</span>(QSharedPointer&lt;Port&gt; port, newPorts)
<a name="l00291"></a>00291             {
<a name="l00292"></a>00292                 <a class="code" href="class_diagram_interface.html#bf23f45de2420db673deaf1530f43d28" title="The top-level component.">component_</a>-&gt;addPort(port);
<a name="l00293"></a>00293             }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295             newBusIf-&gt;setPortMaps(newPortMaps);
<a name="l00296"></a>00296         }
<a name="l00297"></a>00297         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msgBox.clickedButton() == btnManual)
<a name="l00298"></a>00298         {
<a name="l00299"></a>00299             <span class="comment">// Otherwise open the port map tool.</span>
<a name="l00300"></a>00300             <a class="code" href="class_portmap_dialog.html" title="PortmapDialog class.">PortmapDialog</a> dialog(<a class="code" href="class_diagram_interface.html#b7e82cd13f1a74c694ada4c309c1e5a7" title="The library interface.">lh_</a>, <a class="code" href="class_diagram_interface.html#bf23f45de2420db673deaf1530f43d28" title="The top-level component.">component_</a>, newBusIf.data(), other-&gt;<a class="code" href="class_diagram_connection_end_point.html#72cac94a1d12b11e347aa6295b1a6837">getBusInterface</a>().data(),
<a name="l00301"></a>00301                                  (QWidget*)scene()-&gt;parent());
<a name="l00302"></a>00302 
<a name="l00303"></a>00303             <span class="comment">// If the user canceled the dialog, do not make any connection.</span>
<a name="l00304"></a>00304             <span class="keywordflow">if</span> (dialog.exec() == QDialog::Rejected)
<a name="l00305"></a>00305             {
<a name="l00306"></a>00306                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00307"></a>00307             }
<a name="l00308"></a>00308         }
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311     <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a> = newBusIf;
<a name="l00312"></a>00312     <a class="code" href="class_diagram_interface.html#bf23f45de2420db673deaf1530f43d28" title="The top-level component.">component_</a>-&gt;addBusInterface(newBusIf);
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     <span class="comment">// Update the interface visuals.</span>
<a name="l00315"></a>00315     <a class="code" href="class_diagram_interface.html#cf3ba89c9ed6c8da64d399aefb9bdd56" title="Update the graphics to match the IP-XACT bus interface.">updateInterface</a>();
<a name="l00316"></a>00316 
<a name="l00317"></a>00317     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00318"></a>00318 }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00321"></a>00321 <span class="comment">// Function: onDisonnect()</span>
<a name="l00322"></a>00322 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00323"></a><a class="code" href="class_diagram_interface.html#6e8d9a421b286849920a6488adcbc41d">00323</a> <span class="keywordtype">void</span> <a class="code" href="class_diagram_interface.html#6e8d9a421b286849920a6488adcbc41d">DiagramInterface::onDisconnect</a>(<a class="code" href="class_diagram_connection_end_point.html" title="DiagramConnectionEndPoint interface.">DiagramConnectionEndPoint</a> <span class="keyword">const</span>*)
<a name="l00324"></a>00324 {
<a name="l00325"></a>00325     <span class="comment">// Check if there is still some connections left, the bus interface is not defined</span>
<a name="l00326"></a>00326     <span class="comment">// or the interface is not temporary.</span>
<a name="l00327"></a>00327     <span class="keywordflow">if</span> (!<a class="code" href="class_diagram_connection_end_point.html#77a2addc49209f183aa80fa1b2306084">getInterconnections</a>().empty() ||
<a name="l00328"></a>00328         <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;getInterfaceMode() == <a class="code" href="namespace_general.html#4ad6b85c4743ddccd234a0efcf7d05af61ac6c29fbb1f013aba47f69b1e096a9">General::MODE_UNDEFINED</a> || !<a class="code" href="class_diagram_interface.html#d12c97228e6ed3c35f830a3c6634c1db" title="Boolean flag for determining if this interface is temporary or not.">temp_</a>)
<a name="l00329"></a>00329     {
<a name="l00330"></a>00330         <span class="comment">// Don't do anything.</span>
<a name="l00331"></a>00331         <span class="keywordflow">return</span>;
<a name="l00332"></a>00332     }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     <span class="comment">// Otherwise undefine the interface.</span>
<a name="l00335"></a>00335     <a class="code" href="class_diagram_interface.html#07e2818e396e90f4498eeada61f6957b">undefine</a>();
<a name="l00336"></a>00336 
<a name="l00337"></a>00337     <span class="comment">// Update the interface visuals.</span>
<a name="l00338"></a>00338     <a class="code" href="class_diagram_interface.html#cf3ba89c9ed6c8da64d399aefb9bdd56" title="Update the graphics to match the IP-XACT bus interface.">updateInterface</a>();
<a name="l00339"></a>00339 }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00342"></a>00342 <span class="comment">// Function: canConnect()</span>
<a name="l00343"></a>00343 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00344"></a><a class="code" href="class_diagram_interface.html#0a3ae17146215a605ea6f6b50f52291b">00344</a> <span class="keywordtype">bool</span> <a class="code" href="class_diagram_interface.html#0a3ae17146215a605ea6f6b50f52291b">DiagramInterface::canConnect</a>(<a class="code" href="class_diagram_connection_end_point.html" title="DiagramConnectionEndPoint interface.">DiagramConnectionEndPoint</a> <span class="keyword">const</span>* other)<span class="keyword"> const</span>
<a name="l00345"></a>00345 <span class="keyword"></span>{
<a name="l00346"></a>00346     <span class="comment">// Two hierarchical end points cannot be connected together.</span>
<a name="l00347"></a>00347     <span class="keywordflow">if</span> (other-&gt;<a class="code" href="class_diagram_connection_end_point.html#a2bea5faa8a40e3e6ae91987c280b0be" title="Returns true if the port represents a hierarchical connection.">isHierarchical</a>())
<a name="l00348"></a>00348     {
<a name="l00349"></a>00349         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352     QSharedPointer&lt;BusInterface&gt; otherBusIf = other-&gt;<a class="code" href="class_diagram_connection_end_point.html#72cac94a1d12b11e347aa6295b1a6837">getBusInterface</a>();
<a name="l00353"></a>00353 
<a name="l00354"></a>00354     <span class="keywordflow">if</span> (otherBusIf == 0)
<a name="l00355"></a>00355     {
<a name="l00356"></a>00356         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359     <span class="comment">// Connection is allowed if this interface's bus interface is not defined,</span>
<a name="l00360"></a>00360     <span class="comment">// the other end point is unpackaged, or the abstraction definitions of the bus interfaces</span>
<a name="l00361"></a>00361     <span class="comment">// in each end point are equal.</span>
<a name="l00362"></a>00362     <span class="keywordflow">return</span> (<a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;getInterfaceMode() == <a class="code" href="namespace_general.html#4ad6b85c4743ddccd234a0efcf7d05af61ac6c29fbb1f013aba47f69b1e096a9">General::MODE_UNDEFINED</a> ||
<a name="l00363"></a>00363             !otherBusIf-&gt;getBusType().isValid() ||
<a name="l00364"></a>00364             (otherBusIf-&gt;getAbstractionType() == <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;getAbstractionType() &amp;&amp;
<a name="l00365"></a>00365              otherBusIf-&gt;getBusType() == <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;getBusType()));
<a name="l00366"></a>00366 }
<a name="l00367"></a>00367 
<a name="l00368"></a><a class="code" href="class_diagram_interface.html#f98d2467ee664b2cf8a2141e7bbd70be">00368</a> <a class="code" href="class_diagram_component.html" title="DiagramComponent represents graphically an IP-XACT component instance.">DiagramComponent</a> *<a class="code" href="class_diagram_interface.html#f98d2467ee664b2cf8a2141e7bbd70be">DiagramInterface::encompassingComp</a>()<span class="keyword"> const</span>
<a name="l00369"></a>00369 <span class="keyword"></span>{
<a name="l00370"></a>00370     <span class="keywordflow">return</span> qgraphicsitem_cast&lt;<a class="code" href="class_diagram_component.html" title="DiagramComponent represents graphically an IP-XACT component instance.">DiagramComponent</a> *&gt;(parentItem());
<a name="l00371"></a>00371 }
<a name="l00372"></a>00372 
<a name="l00373"></a><a class="code" href="class_diagram_interface.html#09f23f8a677939a827f674a00e07bcf6">00373</a> QSharedPointer&lt;Component&gt; <a class="code" href="class_diagram_interface.html#09f23f8a677939a827f674a00e07bcf6" title="Returns pointer to the top component that owns this interface.">DiagramInterface::ownerComponent</a>()<span class="keyword"> const </span>{
<a name="l00374"></a>00374         Q_ASSERT(<a class="code" href="class_diagram_interface.html#bf23f45de2420db673deaf1530f43d28" title="The top-level component.">component_</a>);
<a name="l00375"></a>00375         <span class="keywordflow">return</span> <a class="code" href="class_diagram_interface.html#bf23f45de2420db673deaf1530f43d28" title="The top-level component.">component_</a>;
<a name="l00376"></a>00376 }
<a name="l00377"></a>00377 
<a name="l00378"></a><a class="code" href="class_diagram_interface.html#0a9ba8bd965fed00630a689c48dabdc4">00378</a> QVariant <a class="code" href="class_diagram_interface.html#0a9ba8bd965fed00630a689c48dabdc4">DiagramInterface::itemChange</a>(GraphicsItemChange change,
<a name="l00379"></a>00379                                  <span class="keyword">const</span> QVariant &amp;value)
<a name="l00380"></a>00380 {
<a name="l00381"></a>00381     <span class="keywordflow">switch</span> (change) {
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     <span class="keywordflow">case</span> ItemPositionChange:
<a name="l00384"></a>00384         {
<a name="l00385"></a>00385             <span class="keywordflow">return</span> <a class="code" href="diagramgrid_8h.html#68afc106817c98c8b7787ff86acee75e" title="Snaps the given QPointF to the diagram grid.">snapPointToGrid</a>(value.toPointF());
<a name="l00386"></a>00386         }
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <span class="keywordflow">case</span> ItemPositionHasChanged:
<a name="l00389"></a>00389         {
<a name="l00390"></a>00390             <span class="keywordflow">if</span> (!parentItem())
<a name="l00391"></a>00391                 <span class="keywordflow">break</span>;
<a name="l00392"></a>00392 
<a name="l00393"></a>00393         emit <a class="code" href="class_diagram_connection_end_point.html#fa7779ad1a6499aa86670c8a0878a5fd" title="Signals that the contents of the interface have been changed.">contentChanged</a>();
<a name="l00394"></a>00394         <span class="keywordflow">break</span>;
<a name="l00395"></a>00395     }
<a name="l00396"></a>00396 
<a name="l00397"></a>00397     <span class="keywordflow">case</span> ItemScenePositionHasChanged:
<a name="l00398"></a>00398         
<a name="l00399"></a>00399         <span class="keywordflow">foreach</span> (<a class="code" href="class_diagram_interconnection.html" title="DiagramInterconnection represents graphically an IP-XACT interconnection.">DiagramInterconnection</a> *interconnection, <a class="code" href="class_diagram_connection_end_point.html#77a2addc49209f183aa80fa1b2306084">getInterconnections</a>()) {
<a name="l00400"></a>00400             interconnection-&gt;<a class="code" href="class_diagram_interconnection.html#5c2eccadec74a5fd6d0b6003fa88c2dc" title="Update the end positions when connected end points are moved.">updatePosition</a>();
<a name="l00401"></a>00401         }
<a name="l00402"></a>00402 
<a name="l00403"></a>00403         <span class="keywordflow">break</span>;
<a name="l00404"></a>00404 
<a name="l00405"></a>00405     <span class="keywordflow">default</span>:
<a name="l00406"></a>00406         <span class="keywordflow">break</span>;
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <span class="keywordflow">return</span> QGraphicsItem::itemChange(change, value);
<a name="l00410"></a>00410 }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00413"></a>00413 <span class="comment">// Function: mouseMoveEvent()</span>
<a name="l00414"></a>00414 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00415"></a><a class="code" href="class_diagram_interface.html#8922839868f60d5b0f191f1d34f64a01">00415</a> <span class="keywordtype">void</span> <a class="code" href="class_diagram_interface.html#8922839868f60d5b0f191f1d34f64a01">DiagramInterface::mouseMoveEvent</a>(QGraphicsSceneMouseEvent* event)
<a name="l00416"></a>00416 {
<a name="l00417"></a>00417     <span class="comment">// Discard mouse move if the diagram is protected.</span>
<a name="l00418"></a>00418     <span class="keywordflow">if</span> (static_cast&lt;BlockDiagram*&gt;(scene())-&gt;isProtected())
<a name="l00419"></a>00419     {
<a name="l00420"></a>00420         <span class="keywordflow">return</span>;
<a name="l00421"></a>00421     }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     DiagramConnectionEndPoint::mouseMoveEvent(event);
<a name="l00424"></a>00424 
<a name="l00425"></a>00425     setPos(parentItem()-&gt;mapFromScene(<a class="code" href="class_diagram_interface.html#7ec153e1952e42c1c27f25739645e63b" title="The old column from where the mouse drag event began.">oldColumn_</a>-&gt;mapToScene(pos())));
<a name="l00426"></a>00426 
<a name="l00427"></a>00427     <a class="code" href="class_diagram_column.html" title="DiagramColumn class.">DiagramColumn</a>* column = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_diagram_column.html" title="DiagramColumn class.">DiagramColumn</a>*<span class="keyword">&gt;</span>(parentItem());
<a name="l00428"></a>00428     Q_ASSERT(column != 0);
<a name="l00429"></a>00429     column-&gt;<a class="code" href="class_diagram_column.html#e0ebb52919f48f47bf9c8a70aba7c36d">onMoveItem</a>(<span class="keyword">this</span>, <a class="code" href="class_diagram_interface.html#7ec153e1952e42c1c27f25739645e63b" title="The old column from where the mouse drag event began.">oldColumn_</a>);
<a name="l00430"></a>00430 }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00433"></a>00433 <span class="comment">// Function: mouseReleaseEvent()</span>
<a name="l00434"></a>00434 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00435"></a><a class="code" href="class_diagram_interface.html#e5d776e566f361e0a610b7e8266f742d">00435</a> <span class="keywordtype">void</span> <a class="code" href="class_diagram_interface.html#e5d776e566f361e0a610b7e8266f742d">DiagramInterface::mouseReleaseEvent</a>(QGraphicsSceneMouseEvent* event)
<a name="l00436"></a>00436 {
<a name="l00437"></a>00437     DiagramConnectionEndPoint::mouseReleaseEvent(event);
<a name="l00438"></a>00438     setZValue(0.0);
<a name="l00439"></a>00439 
<a name="l00440"></a>00440     <span class="keywordflow">if</span> (<a class="code" href="class_diagram_interface.html#7ec153e1952e42c1c27f25739645e63b" title="The old column from where the mouse drag event began.">oldColumn_</a> != 0)
<a name="l00441"></a>00441     {
<a name="l00442"></a>00442         <a class="code" href="class_diagram_column.html" title="DiagramColumn class.">DiagramColumn</a>* column = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_diagram_column.html" title="DiagramColumn class.">DiagramColumn</a>*<span class="keyword">&gt;</span>(parentItem());
<a name="l00443"></a>00443         Q_ASSERT(column != 0);
<a name="l00444"></a>00444         column-&gt;<a class="code" href="class_diagram_column.html#9630ca472f614399dff11f3fc0580a92">onReleaseItem</a>(<span class="keyword">this</span>);
<a name="l00445"></a>00445 
<a name="l00446"></a>00446         <a class="code" href="class_diagram_interface.html#7ec153e1952e42c1c27f25739645e63b" title="The old column from where the mouse drag event began.">oldColumn_</a> = 0;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448         QSharedPointer&lt;QUndoCommand&gt; cmd;
<a name="l00449"></a>00449 
<a name="l00450"></a>00450         <span class="comment">// Check if the interface position was really changed.</span>
<a name="l00451"></a>00451         <span class="keywordflow">if</span> (<a class="code" href="class_diagram_interface.html#6e1790a3ccc4acc05694b92c35d429d6" title="The position of the interface before a mouse move.">oldPos_</a> != scenePos())
<a name="l00452"></a>00452         {
<a name="l00453"></a>00453             cmd = QSharedPointer&lt;QUndoCommand&gt;(<span class="keyword">new</span> <a class="code" href="class_item_move_command.html" title="ItemMoveCommand class.">ItemMoveCommand</a>(<span class="keyword">this</span>, <a class="code" href="class_diagram_interface.html#6e1790a3ccc4acc05694b92c35d429d6" title="The position of the interface before a mouse move.">oldPos_</a>));
<a name="l00454"></a>00454         }
<a name="l00455"></a>00455         <span class="keywordflow">else</span>
<a name="l00456"></a>00456         {
<a name="l00457"></a>00457             cmd = QSharedPointer&lt;QUndoCommand&gt;(<span class="keyword">new</span> QUndoCommand());
<a name="l00458"></a>00458         }
<a name="l00459"></a>00459 
<a name="l00460"></a>00460         <span class="comment">// Determine if the other interfaces changed their position and create undo commands for them.</span>
<a name="l00461"></a>00461         QMap&lt;DiagramInterface*, QPointF&gt;::iterator cur = <a class="code" href="class_diagram_interface.html#ff9df864f9a96fede1e82c79bd9cc134" title="The old positions of the other interfaces before mouse move.">oldInterfacePositions_</a>.begin();
<a name="l00462"></a>00462 
<a name="l00463"></a>00463         <span class="keywordflow">while</span> (cur != <a class="code" href="class_diagram_interface.html#ff9df864f9a96fede1e82c79bd9cc134" title="The old positions of the other interfaces before mouse move.">oldInterfacePositions_</a>.end())
<a name="l00464"></a>00464         {
<a name="l00465"></a>00465             <span class="keywordflow">if</span> (cur.key()-&gt;scenePos() != cur.value())
<a name="l00466"></a>00466             {
<a name="l00467"></a>00467                 QUndoCommand* childCmd = <span class="keyword">new</span> <a class="code" href="class_item_move_command.html" title="ItemMoveCommand class.">ItemMoveCommand</a>(cur.key(), cur.value(), cmd.data());
<a name="l00468"></a>00468             }
<a name="l00469"></a>00469 
<a name="l00470"></a>00470             ++cur;
<a name="l00471"></a>00471         }
<a name="l00472"></a>00472 
<a name="l00473"></a>00473         <a class="code" href="class_diagram_interface.html#ff9df864f9a96fede1e82c79bd9cc134" title="The old positions of the other interfaces before mouse move.">oldInterfacePositions_</a>.clear();
<a name="l00474"></a>00474 
<a name="l00475"></a>00475         <span class="comment">// End the position update of the connections.</span>
<a name="l00476"></a>00476         <span class="keywordflow">foreach</span> (<a class="code" href="class_diagram_interconnection.html" title="DiagramInterconnection represents graphically an IP-XACT interconnection.">DiagramInterconnection</a>* conn, <a class="code" href="class_diagram_connection_end_point.html#77a2addc49209f183aa80fa1b2306084">getInterconnections</a>())
<a name="l00477"></a>00477         {
<a name="l00478"></a>00478             conn-&gt;<a class="code" href="class_diagram_interconnection.html#de974117c39c74a61c8c2ec238d20ed6">endUpdatePosition</a>(cmd.data());
<a name="l00479"></a>00479         }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481         <span class="comment">// Add the undo command to the edit stack only if it has changes.</span>
<a name="l00482"></a>00482         <span class="keywordflow">if</span> (cmd-&gt;childCount() &gt; 0 || <a class="code" href="class_diagram_interface.html#6e1790a3ccc4acc05694b92c35d429d6" title="The position of the interface before a mouse move.">oldPos_</a> != scenePos())
<a name="l00483"></a>00483         {
<a name="l00484"></a>00484             column-&gt;<a class="code" href="class_diagram_column.html#2345cf827afd09ce3e233a28146e7869">getEditProvider</a>().<a class="code" href="class_generic_edit_provider.html#a44aaae7b9a6c25882059e45d8b24e1c">addCommand</a>(cmd, <span class="keyword">false</span>);
<a name="l00485"></a>00485         }
<a name="l00486"></a>00486     }
<a name="l00487"></a>00487 }
<a name="l00488"></a>00488 
<a name="l00489"></a>00489 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00490"></a>00490 <span class="comment">// Function: mousePressEvent()</span>
<a name="l00491"></a>00491 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00492"></a><a class="code" href="class_diagram_interface.html#1ea5ead51f4085e9cb56b0f6bfe1897d">00492</a> <span class="keywordtype">void</span> <a class="code" href="class_diagram_interface.html#1ea5ead51f4085e9cb56b0f6bfe1897d">DiagramInterface::mousePressEvent</a>(QGraphicsSceneMouseEvent *event)
<a name="l00493"></a>00493 {
<a name="l00494"></a>00494     DiagramConnectionEndPoint::mousePressEvent(event);
<a name="l00495"></a>00495     setZValue(1001.0);
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     <a class="code" href="class_diagram_interface.html#7ec153e1952e42c1c27f25739645e63b" title="The old column from where the mouse drag event began.">oldColumn_</a> = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_diagram_column.html" title="DiagramColumn class.">DiagramColumn</a>*<span class="keyword">&gt;</span>(parentItem());
<a name="l00498"></a>00498     <a class="code" href="class_diagram_interface.html#6e1790a3ccc4acc05694b92c35d429d6" title="The position of the interface before a mouse move.">oldPos_</a> = scenePos();
<a name="l00499"></a>00499     Q_ASSERT(<a class="code" href="class_diagram_interface.html#7ec153e1952e42c1c27f25739645e63b" title="The old column from where the mouse drag event began.">oldColumn_</a> != 0);
<a name="l00500"></a>00500 
<a name="l00501"></a>00501     <span class="comment">// Save the positions of the other diagram interfaces.</span>
<a name="l00502"></a>00502     <span class="keywordflow">foreach</span> (<a class="code" href="class_diagram_column.html" title="DiagramColumn class.">DiagramColumn</a>* column, <a class="code" href="class_diagram_interface.html#7ec153e1952e42c1c27f25739645e63b" title="The old column from where the mouse drag event began.">oldColumn_</a>-&gt;<a class="code" href="class_diagram_column.html#b91baa63b90cf447ad941c2944d2d0d4">getLayout</a>().<a class="code" href="class_diagram_column_layout.html#dcf463706f439565ab4f1dfcfecbf5bd">getColumns</a>())
<a name="l00503"></a>00503     {
<a name="l00504"></a>00504         <span class="keywordflow">if</span> (column-&gt;<a class="code" href="class_diagram_column.html#3e56a4e856b3a71427b12f61d6b59125">getContentType</a>() == <a class="code" href="_column_types_8h.html#18482e6ad6fa8d85c08436f7620051430e9af5ae7c85f5dfe567be68b546a40a">COLUMN_CONTENT_IO</a>)
<a name="l00505"></a>00505         {
<a name="l00506"></a>00506             <span class="keywordflow">foreach</span> (QGraphicsItem* item, column-&gt;childItems())
<a name="l00507"></a>00507             {
<a name="l00508"></a>00508                 <span class="keywordflow">if</span> (item-&gt;type() == <a class="code" href="class_diagram_interface.html#7252a4c651690c7d55ab1b7bfbc96344ae7a656c2a1e9a6d9bd573c3f8b0d491">DiagramInterface::Type</a>)
<a name="l00509"></a>00509                 {
<a name="l00510"></a>00510                     <a class="code" href="class_diagram_interface.html" title="DiagramInterface class.">DiagramInterface</a>* interface = <span class="keyword">static_cast&lt;</span><a class="code" href="class_diagram_interface.html" title="DiagramInterface class.">DiagramInterface</a>*<span class="keyword">&gt;</span>(item);
<a name="l00511"></a>00511                     <a class="code" href="class_diagram_interface.html#ff9df864f9a96fede1e82c79bd9cc134" title="The old positions of the other interfaces before mouse move.">oldInterfacePositions_</a>.insert(interface, interface-&gt;scenePos());
<a name="l00512"></a>00512                 }
<a name="l00513"></a>00513             }
<a name="l00514"></a>00514         }
<a name="l00515"></a>00515     }
<a name="l00516"></a>00516 
<a name="l00517"></a>00517     <span class="comment">// Begin the position update of the connections.</span>
<a name="l00518"></a>00518     <span class="keywordflow">foreach</span> (<a class="code" href="class_diagram_interconnection.html" title="DiagramInterconnection represents graphically an IP-XACT interconnection.">DiagramInterconnection</a>* conn, <a class="code" href="class_diagram_connection_end_point.html#77a2addc49209f183aa80fa1b2306084">getInterconnections</a>())
<a name="l00519"></a>00519     {
<a name="l00520"></a>00520         conn-&gt;<a class="code" href="class_diagram_interconnection.html#ae78d43ef591d5a88b10e151cb358b6f">beginUpdatePosition</a>();
<a name="l00521"></a>00521     }
<a name="l00522"></a>00522 }
<a name="l00523"></a>00523 
<a name="l00524"></a>00524 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00525"></a>00525 <span class="comment">// Function: setDirection()</span>
<a name="l00526"></a>00526 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00527"></a><a class="code" href="class_diagram_interface.html#f80187dd750611e4bca0db569803590e">00527</a> <span class="keywordtype">void</span> <a class="code" href="class_diagram_interface.html#f80187dd750611e4bca0db569803590e">DiagramInterface::setDirection</a>(QVector2D <span class="keyword">const</span>&amp; dir)
<a name="l00528"></a>00528 {
<a name="l00529"></a>00529     <a class="code" href="class_diagram_connection_end_point.html#118018fc1eb247ba0466cfd1b5c128fa">DiagramConnectionEndPoint::setDirection</a>(dir);
<a name="l00530"></a>00530 
<a name="l00531"></a>00531     <span class="comment">// Update the position of the name label based on the direction.</span>
<a name="l00532"></a>00532     qreal nameWidth = <a class="code" href="class_diagram_interface.html#b2d6ac125253fb58e9b905d2b6f07d78" title="The name label.">nameLabel_</a>-&gt;boundingRect().width();
<a name="l00533"></a>00533     
<a name="l00534"></a>00534     <span class="comment">// Check if the interface is directed to the left.</span>
<a name="l00535"></a>00535     <span class="keywordflow">if</span> (dir.x() &lt; 0)
<a name="l00536"></a>00536     {
<a name="l00537"></a>00537         <a class="code" href="class_diagram_interface.html#b2d6ac125253fb58e9b905d2b6f07d78" title="The name label.">nameLabel_</a>-&gt;setPos(0, <a class="code" href="diagramgrid_8h.html#550f81d71b4b514a24f5a8e3023a1152">GridSize</a> * 3.0 / 4.0 - nameWidth / 2.0);
<a name="l00538"></a>00538     }
<a name="l00539"></a>00539     <span class="comment">// Otherwise the interface is directed to the right.</span>
<a name="l00540"></a>00540     <span class="keywordflow">else</span>
<a name="l00541"></a>00541     {
<a name="l00542"></a>00542         <a class="code" href="class_diagram_interface.html#b2d6ac125253fb58e9b905d2b6f07d78" title="The name label.">nameLabel_</a>-&gt;setPos(0, <a class="code" href="diagramgrid_8h.html#550f81d71b4b514a24f5a8e3023a1152">GridSize</a> * 3.0 / 4.0 + nameWidth / 2.0);
<a name="l00543"></a>00543     }
<a name="l00544"></a>00544 }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00547"></a>00547 <span class="comment">// Function: setTemporary()</span>
<a name="l00548"></a>00548 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00549"></a><a class="code" href="class_diagram_interface.html#318c78fd1b4436e6cc0f27516ba843e0">00549</a> <span class="keywordtype">void</span> <a class="code" href="class_diagram_interface.html#318c78fd1b4436e6cc0f27516ba843e0">DiagramInterface::setTemporary</a>(<span class="keywordtype">bool</span> temp)
<a name="l00550"></a>00550 {
<a name="l00551"></a>00551     <a class="code" href="class_diagram_interface.html#d12c97228e6ed3c35f830a3c6634c1db" title="Boolean flag for determining if this interface is temporary or not.">temp_</a> = temp;
<a name="l00552"></a>00552 }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00555"></a>00555 <span class="comment">// Function: setTypes()</span>
<a name="l00556"></a>00556 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00557"></a><a class="code" href="class_diagram_interface.html#b6f9f5de41229351d58ac6ed9b365bf5">00557</a> <span class="keywordtype">void</span> <a class="code" href="class_diagram_interface.html#b6f9f5de41229351d58ac6ed9b365bf5">DiagramInterface::setTypes</a>(<a class="code" href="class_v_l_n_v.html" title="The class to hold VLNV information of a single IP-XACT document.">VLNV</a> <span class="keyword">const</span>&amp; busType, <a class="code" href="class_v_l_n_v.html" title="The class to hold VLNV information of a single IP-XACT document.">VLNV</a> <span class="keyword">const</span>&amp; absType, <a class="code" href="namespace_general.html#4ad6b85c4743ddccd234a0efcf7d05af" title="Describes the mode for an interface.">General::InterfaceMode</a> mode)
<a name="l00558"></a>00558 {
<a name="l00559"></a>00559     <span class="comment">// Destroy the old bus interface if it exists.</span>
<a name="l00560"></a>00560     <span class="keywordflow">if</span> (<a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;getInterfaceMode() != <a class="code" href="namespace_general.html#4ad6b85c4743ddccd234a0efcf7d05af61ac6c29fbb1f013aba47f69b1e096a9">General::MODE_UNDEFINED</a>)
<a name="l00561"></a>00561     {
<a name="l00562"></a>00562         <span class="comment">// Disconnect the connections.</span>
<a name="l00563"></a>00563         <span class="keywordflow">foreach</span>(<a class="code" href="class_diagram_interconnection.html" title="DiagramInterconnection represents graphically an IP-XACT interconnection.">DiagramInterconnection</a>* conn, <a class="code" href="class_diagram_connection_end_point.html#77a2addc49209f183aa80fa1b2306084">getInterconnections</a>())
<a name="l00564"></a>00564         {
<a name="l00565"></a>00565             <span class="keywordflow">if</span> (conn-&gt;<a class="code" href="class_diagram_interconnection.html#c76e3854d8ed34174e3e821497fc9bf2" title="Return the first end point connected.">endPoint1</a>() != <span class="keyword">this</span>)
<a name="l00566"></a>00566             {
<a name="l00567"></a>00567                 conn-&gt;<a class="code" href="class_diagram_interconnection.html#c76e3854d8ed34174e3e821497fc9bf2" title="Return the first end point connected.">endPoint1</a>()-&gt;<a class="code" href="class_diagram_connection_end_point.html#507461a037639ef2b1776a6b797d2211">onDisconnect</a>(<span class="keyword">this</span>);
<a name="l00568"></a>00568             }
<a name="l00569"></a>00569             <span class="keywordflow">else</span>
<a name="l00570"></a>00570             {
<a name="l00571"></a>00571                 conn-&gt;<a class="code" href="class_diagram_interconnection.html#ffac0f0f479b95c98de4144dbd9c5867" title="Return the second end point connected.">endPoint2</a>()-&gt;<a class="code" href="class_diagram_connection_end_point.html#507461a037639ef2b1776a6b797d2211">onDisconnect</a>(<span class="keyword">this</span>);
<a name="l00572"></a>00572             }
<a name="l00573"></a>00573         }
<a name="l00574"></a>00574 
<a name="l00575"></a>00575         <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;setInterfaceMode(<a class="code" href="namespace_general.html#4ad6b85c4743ddccd234a0efcf7d05af61ac6c29fbb1f013aba47f69b1e096a9">General::MODE_UNDEFINED</a>);
<a name="l00576"></a>00576     }
<a name="l00577"></a>00577 
<a name="l00578"></a>00578     <span class="keywordflow">if</span> (busType.<a class="code" href="class_v_l_n_v.html#f02edbeb4feca8206bdb6681963730f8" title="Checks if the vlnv is valid or not.">isValid</a>())
<a name="l00579"></a>00579     {
<a name="l00580"></a>00580         <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;setBusType(busType);
<a name="l00581"></a>00581         <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;setAbstractionType(absType);
<a name="l00582"></a>00582         <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;setInterfaceMode(mode);
<a name="l00583"></a>00583 
<a name="l00584"></a>00584         <a class="code" href="class_diagram_interface.html#318c78fd1b4436e6cc0f27516ba843e0">setTemporary</a>(<span class="keyword">false</span>);
<a name="l00585"></a>00585 
<a name="l00586"></a>00586         <span class="comment">// Update the interface visuals.</span>
<a name="l00587"></a>00587         <a class="code" href="class_diagram_interface.html#cf3ba89c9ed6c8da64d399aefb9bdd56" title="Update the graphics to match the IP-XACT bus interface.">updateInterface</a>();
<a name="l00588"></a>00588 
<a name="l00589"></a>00589         <span class="comment">// Undefined end points of the connections can now be defined.</span>
<a name="l00590"></a>00590         <span class="keywordflow">foreach</span>(<a class="code" href="class_diagram_interconnection.html" title="DiagramInterconnection represents graphically an IP-XACT interconnection.">DiagramInterconnection</a>* conn, <a class="code" href="class_diagram_connection_end_point.html#77a2addc49209f183aa80fa1b2306084">getInterconnections</a>())
<a name="l00591"></a>00591         {
<a name="l00592"></a>00592             <span class="keywordflow">if</span> (conn-&gt;<a class="code" href="class_diagram_interconnection.html#c76e3854d8ed34174e3e821497fc9bf2" title="Return the first end point connected.">endPoint1</a>() != <span class="keyword">this</span>)
<a name="l00593"></a>00593             {
<a name="l00594"></a>00594                 conn-&gt;<a class="code" href="class_diagram_interconnection.html#c76e3854d8ed34174e3e821497fc9bf2" title="Return the first end point connected.">endPoint1</a>()-&gt;<a class="code" href="class_diagram_connection_end_point.html#88f1921941349a0cf25447e41f30045a">onConnect</a>(<span class="keyword">this</span>);
<a name="l00595"></a>00595                 conn-&gt;<a class="code" href="class_diagram_interconnection.html#ffac0f0f479b95c98de4144dbd9c5867" title="Return the second end point connected.">endPoint2</a>()-&gt;<a class="code" href="class_diagram_connection_end_point.html#88f1921941349a0cf25447e41f30045a">onConnect</a>(conn-&gt;<a class="code" href="class_diagram_interconnection.html#c76e3854d8ed34174e3e821497fc9bf2" title="Return the first end point connected.">endPoint1</a>());
<a name="l00596"></a>00596             }
<a name="l00597"></a>00597             <span class="keywordflow">else</span>
<a name="l00598"></a>00598             {
<a name="l00599"></a>00599                 conn-&gt;<a class="code" href="class_diagram_interconnection.html#ffac0f0f479b95c98de4144dbd9c5867" title="Return the second end point connected.">endPoint2</a>()-&gt;<a class="code" href="class_diagram_connection_end_point.html#88f1921941349a0cf25447e41f30045a">onConnect</a>(<span class="keyword">this</span>);
<a name="l00600"></a>00600                 conn-&gt;<a class="code" href="class_diagram_interconnection.html#c76e3854d8ed34174e3e821497fc9bf2" title="Return the first end point connected.">endPoint1</a>()-&gt;<a class="code" href="class_diagram_connection_end_point.html#88f1921941349a0cf25447e41f30045a">onConnect</a>(conn-&gt;<a class="code" href="class_diagram_interconnection.html#ffac0f0f479b95c98de4144dbd9c5867" title="Return the second end point connected.">endPoint2</a>());
<a name="l00601"></a>00601             }
<a name="l00602"></a>00602         }
<a name="l00603"></a>00603     }
<a name="l00604"></a>00604     <span class="keywordflow">else</span>
<a name="l00605"></a>00605     {
<a name="l00606"></a>00606         <a class="code" href="class_diagram_interface.html#318c78fd1b4436e6cc0f27516ba843e0">setTemporary</a>(<span class="keyword">true</span>);
<a name="l00607"></a>00607 
<a name="l00608"></a>00608         <span class="comment">// Update the interface visuals.</span>
<a name="l00609"></a>00609         <a class="code" href="class_diagram_interface.html#cf3ba89c9ed6c8da64d399aefb9bdd56" title="Update the graphics to match the IP-XACT bus interface.">updateInterface</a>();
<a name="l00610"></a>00610     }
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00614"></a>00614 <span class="comment">// Function: define()</span>
<a name="l00615"></a>00615 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00616"></a><a class="code" href="class_diagram_interface.html#916e5d0630860680e522c99dcfa69964">00616</a> <span class="keywordtype">void</span> <a class="code" href="class_diagram_interface.html#916e5d0630860680e522c99dcfa69964">DiagramInterface::define</a>(QSharedPointer&lt;BusInterface&gt; busIf,
<a name="l00617"></a>00617                               QList&lt; QSharedPointer&lt;Port&gt; &gt; ports)
<a name="l00618"></a>00618 {
<a name="l00619"></a>00619     <span class="comment">// Add the ports to the top-level component.</span>
<a name="l00620"></a>00620     <span class="keywordflow">foreach</span> (QSharedPointer&lt;Port&gt; port, ports)
<a name="l00621"></a>00621     {
<a name="l00622"></a>00622         <a class="code" href="class_diagram_interface.html#bf23f45de2420db673deaf1530f43d28" title="The top-level component.">component_</a>-&gt;addPort(port);
<a name="l00623"></a>00623     }
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     <span class="comment">// Add the bus interface to the component.</span>
<a name="l00626"></a>00626     <a class="code" href="class_diagram_interface.html#bf23f45de2420db673deaf1530f43d28" title="The top-level component.">component_</a>-&gt;addBusInterface(busIf);
<a name="l00627"></a>00627     <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a> = busIf;
<a name="l00628"></a>00628 
<a name="l00629"></a>00629     <span class="comment">// Update the interface visuals.</span>
<a name="l00630"></a>00630     <a class="code" href="class_diagram_interface.html#cf3ba89c9ed6c8da64d399aefb9bdd56" title="Update the graphics to match the IP-XACT bus interface.">updateInterface</a>();
<a name="l00631"></a>00631 }
<a name="l00632"></a>00632 
<a name="l00633"></a>00633 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00634"></a>00634 <span class="comment">// Function: undefine()</span>
<a name="l00635"></a>00635 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00636"></a><a class="code" href="class_diagram_interface.html#07e2818e396e90f4498eeada61f6957b">00636</a> <span class="keywordtype">void</span> <a class="code" href="class_diagram_interface.html#07e2818e396e90f4498eeada61f6957b">DiagramInterface::undefine</a>()
<a name="l00637"></a>00637 {
<a name="l00638"></a>00638     <span class="comment">// Delete all ports related to the bus interface from the top-level component.</span>
<a name="l00639"></a>00639     QList&lt; QSharedPointer&lt;General::PortMap&gt; &gt; <span class="keyword">const</span>&amp; portMaps = <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;getPortMaps();
<a name="l00640"></a>00640 
<a name="l00641"></a>00641     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; portMaps.size(); ++i)
<a name="l00642"></a>00642     {
<a name="l00643"></a>00643         <a class="code" href="class_diagram_interface.html#bf23f45de2420db673deaf1530f43d28" title="The top-level component.">component_</a>-&gt;removePort(portMaps.at(i)-&gt;physicalPort_);
<a name="l00644"></a>00644     }
<a name="l00645"></a>00645 
<a name="l00646"></a>00646     <span class="comment">// Remove the bus interface from the top-level component and destroy it.</span>
<a name="l00647"></a>00647     <a class="code" href="class_diagram_interface.html#bf23f45de2420db673deaf1530f43d28" title="The top-level component.">component_</a>-&gt;removeBusInterface(<a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;getName());
<a name="l00648"></a>00648     <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>.clear();
<a name="l00649"></a>00649 }
<a name="l00650"></a>00650 
<a name="l00651"></a>00651 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00652"></a>00652 <span class="comment">// Function: getPorts()</span>
<a name="l00653"></a>00653 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00654"></a><a class="code" href="class_diagram_interface.html#d4d4ffa308c0e509c8f8ac21149239f0">00654</a> QList&lt;Port*&gt; <a class="code" href="class_diagram_interface.html#d4d4ffa308c0e509c8f8ac21149239f0">DiagramInterface::getPorts</a>()<span class="keyword"> const</span>
<a name="l00655"></a>00655 <span class="keyword"></span>{
<a name="l00656"></a>00656     Q_ASSERT(<a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a> != 0);
<a name="l00657"></a>00657     QList&lt;Port*&gt; ports;
<a name="l00658"></a>00658 
<a name="l00659"></a>00659     QList&lt; QSharedPointer&lt;General::PortMap&gt; &gt; <span class="keyword">const</span>&amp; portMaps = <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;getPortMaps();
<a name="l00660"></a>00660 
<a name="l00661"></a>00661     <span class="keywordflow">foreach</span> (QSharedPointer&lt;General::PortMap&gt; portMap, portMaps)
<a name="l00662"></a>00662     {
<a name="l00663"></a>00663         <a class="code" href="class_port.html" title="Equals the spirit:port element in IP-Xact specification.">Port</a>* port = <a class="code" href="class_diagram_interface.html#bf23f45de2420db673deaf1530f43d28" title="The top-level component.">component_</a>-&gt;getPort(portMap-&gt;physicalPort_);
<a name="l00664"></a>00664 
<a name="l00665"></a>00665         <span class="keywordflow">if</span> (port != 0)
<a name="l00666"></a>00666         {
<a name="l00667"></a>00667             ports.append(port);
<a name="l00668"></a>00668         }
<a name="l00669"></a>00669     }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671     <span class="keywordflow">return</span> ports;
<a name="l00672"></a>00672 }
<a name="l00673"></a>00673 
<a name="l00674"></a><a class="code" href="class_diagram_interface.html#693c1b64cdf55959658a53699e280b90">00674</a> <span class="keywordtype">void</span> <a class="code" href="class_diagram_interface.html#693c1b64cdf55959658a53699e280b90" title="Set the interface mode for the end point.">DiagramInterface::setInterfaceMode</a>( <a class="code" href="namespace_general.html#4ad6b85c4743ddccd234a0efcf7d05af" title="Describes the mode for an interface.">General::InterfaceMode</a> mode ) {
<a name="l00675"></a>00675         Q_ASSERT(<a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>);
<a name="l00676"></a>00676         <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;setInterfaceMode(mode);
<a name="l00677"></a>00677         <a class="code" href="class_diagram_interface.html#cf3ba89c9ed6c8da64d399aefb9bdd56" title="Update the graphics to match the IP-XACT bus interface.">updateInterface</a>();
<a name="l00678"></a>00678 }
<a name="l00679"></a>00679 
<a name="l00680"></a><a class="code" href="class_diagram_interface.html#eae0ac60d23515f8d8e26289eb0789c0">00680</a> QString <a class="code" href="class_diagram_interface.html#eae0ac60d23515f8d8e26289eb0789c0" title="Get the description of the interface.">DiagramInterface::description</a>()<span class="keyword"> const </span>{
<a name="l00681"></a>00681         Q_ASSERT(<a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>);
<a name="l00682"></a>00682         <span class="keywordflow">return</span> <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;getDescription();
<a name="l00683"></a>00683 }
<a name="l00684"></a>00684 
<a name="l00685"></a><a class="code" href="class_diagram_interface.html#7f14daee252b2c694ff0b460dbb426b3">00685</a> <span class="keywordtype">void</span> <a class="code" href="class_diagram_interface.html#7f14daee252b2c694ff0b460dbb426b3" title="Set the description for the interface.">DiagramInterface::setDescription</a>( <span class="keyword">const</span> QString&amp; <a class="code" href="class_diagram_interface.html#eae0ac60d23515f8d8e26289eb0789c0" title="Get the description of the interface.">description</a> ) {
<a name="l00686"></a>00686         Q_ASSERT(<a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>);
<a name="l00687"></a>00687         <a class="code" href="class_diagram_interface.html#8a9006d59b46cd31ac52de65d16a6268" title="The bus interface.">busInterface_</a>-&gt;setDescription(description);
<a name="l00688"></a>00688         emit <a class="code" href="class_diagram_connection_end_point.html#fa7779ad1a6499aa86670c8a0878a5fd" title="Signals that the contents of the interface have been changed.">contentChanged</a>();
<a name="l00689"></a>00689 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Nov 30 12:12:40 2011 for Kactus2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
